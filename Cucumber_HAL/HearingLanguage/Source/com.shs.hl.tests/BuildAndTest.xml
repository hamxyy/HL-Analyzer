<?xml version="1.0" encoding="UTF-8"?>
<project name="Build and Test Code" default="BuildAndTest"
	basedir=".">

	<property name="eclipse.home" location="c:/program files/Eclipse4.3.0.0" />
	<property name="build.compiler" value="org.eclipse.jdt.core.JDTCompilerAdapter" />


	<property name="baseLocation" location="${eclipse.home}" />
	<property name="base" location="${baseLocation}/.." />

	<property name="workspace.dir" location="./../.." />
	<property name="source.dir" location="${workspace.dir}/Source" />
	<property name="build.dir" location="${workspace.dir}/Output" />
	<property name="test.models" location="${source.dir}/com.shs.hl.tests.models" />
	<property name="test.stdlib" location="${source.dir}/com.shs.hl.tests.models/stdlib" />
	<property name="test.report.dir" location="${build.dir}/TestReport" />

	<path id="compile">
		<!--<pathelement path="${classpath}" /> -->

		<!--<pathelement path="."/> -->
		<!-- <pathelement location="${source.dir}"/> -->
		<pathelement location="."/>
		<pathelement location="${test.stdlib}"/>

		<fileset dir="${eclipse.home}/plugins/">
			<include name="**/*.jar"/>		
		</fileset>

		<dirset dir="${build.dir}">
			<include name="plugins/**/@dot" />
		</dirset>
		
		<dirset dir="${test.stdlib} ">
			<include name="**/*.cl"/>
		 	<include name="**/*.hl"/> 
		</dirset>
		
		<dirset dir="${source.dir}/com.shs.hl.tests">
			<include name="bin/**" />
		</dirset>

	</path>


	<target name="BuildAndTest" depends="Build, Test">
	</target>

	<target name="Build">
		<!-- <antcall target="Generic.Compile" inheritall="false" inheritrefs="true"> 
			<param name="prj" location="${source.dir}/de.itemis.xtext.typesystem.testing"/> 
			</antcall> -->
		<antcall target="Generic.Compile" inheritall="false"
			inheritrefs="true">
			<param name="prj" location="${source.dir}/com.shs.hl.tests" />
		</antcall>
	</target>

	<target name="Generic.Compile" depends="Generic.Clean">
		<javac source="1.6" target="1.6" destdir="${prj}/bin" srcdir="${prj}/src"
			classpathref="compile" />
	</target>

	<target name="Generic.Clean">
		<delete dir="${prj}/bin" />
		<mkdir dir="${prj}/bin" />
	</target>

	<target name="Test" depends="Clean.Test">
		<echo message="============== Path definition used for Junit test generator =======================" level="info" />
		<pathconvert pathsep="${line.separator}" property="givenPath" refid="compile" />
		<echo message="${givenPath}" />
		<echo message="===============================================================================" />
		
		<junit printsummary="true">
			<classpath refid= "compile"/>
			<!-- run all tests of com.shs.hl.tests -->
			<formatter type="plain" usefile="true" />
			<formatter type="xml" usefile="true" />

			<batchtest todir="${test.report.dir}">
				<fileset dir="${source.dir}/com.shs.hl.tests/bin">
					<include name="**/*.class" />
					<exclude name="**/AllTests.*" />
					<exclude name="**/R.*" />
				</fileset>
			</batchtest>
		</junit>

	</target>

	<target name="Clean.Test">
		<delete dir="${test.report.dir}" />
		<mkdir dir="${test.report.dir}" />
	</target>

</project>